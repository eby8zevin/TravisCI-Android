language: android
jdk: oraclejdk8

android:
  components:
    - tools
  licenses:
    - android-sdk-license-.+

before_install:
  - openssl aes-256-cbc -K $encrypted_cbeaef396b1f_key -iv $encrypted_cbeaef396b1f_iv -in archive.tar.gz.enc -out archive.tar.gz -d
  - tar -xzvf archive.tar.gz
  - chmod +x gradlew

before_script:
  - echo yes | ${ANDROID_HOME}tools/bin/sdkmanager "tools"
  - echo yes | ${ANDROID_HOME}tools/bin/sdkmanager "platform-tools"
  - echo yes | ${ANDROID_HOME}tools/bin/sdkmanager "build-tools;30.0.1"
  - echo yes | ${ANDROID_HOME}tools/bin/sdkmanager "platforms;android-25"

script:
  - ./gradlew clean build

before_cache:
  - rm -f  $HOME/.gradle/caches/modules-2/modules-2.lock
  - rm -fr $HOME/.gradle/caches/*/plugin-resolution/

cache:
  directories:
    - $HOME/.gradle/caches/
    - $HOME/.gradle/wrapper/
    - $HOME/.android/build-cache

deploy:
  provider: releases
  api_key:
    secure: Sya77kbMuj1cE+CZwnmOE1r6rw08w4Iw/JRLR0/rK0oB1n6QLG6riwN54/RbSiBboBhe7+Qb+oT8eZtNTPq4rBYn+qUeTx4P7aoDhsSLpzd/0uQEYmBnQ/zQf6mnJiqiLnKuOzO7tL4W2q5bgXGavhlhL95f1tHSiPrXw782LZ5B/yV3yRbDwf9aEW5Bso06kzeD2XpfSdq9/uhBieBQLOLU9lWK1xZPtJRdczn7jDUe6JN8uGpJv2lO5xKl9M/zJS5N+3kf5mdZ9BrLmSLjRdNcWRMoouymRY3kQ7pM1j6O28dGId8v2thrkPnNHqj68eWG8A5nRiWhatra2Yj5l8LVrCP5tw2N9aOie+mCaZiyem7PU/mReEztHjvSwDy5h0YESZV/L3TA5D4cBhWhTTPz9rcWCZQEYNhObA7n82PSH2lUziTJ0YSMX0XnOhLOSdKdpuEhXGWRoa6GP5hmaL9xEcXMTXCrBZWwOytsm5r/H6QrgSMwtU6BAXQ8GBoQZbLULKTalfKvEgR/OggmTIH9RLIOKqFYe0hdxxY7g+rxgQMz1yQv1vmclABv0ZlHCtlXl2HhzhLqHOJJ3t1H2ETk+BbeKzULq7O7kTgPgT3VwaIwSixccO9JAheTuffRhElw5SH/wWE4DXHIWnwC3kZflz9YOBRbO17eZYonmrw=
  file: app/release/app-release.apk
  skip_cleanup: true
  on:
    repo: eby8zevin/TravisCI-Android
    tags: true

notifications:
  email: false
